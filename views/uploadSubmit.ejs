<!DOCTYPE html>
<html lang="en">
<%- include('partials/head') %>
<body class="dark-theme">
    <%- include('partials/header') %>
    <%- include('partials/nav') %>
    <main>
        <div class="container">
           <section class="mode-submission-section">
               <form action="/upload/submit" method="post">
                   <div class="mode-info">
                       <h2>Mode Submission</h2>
                       <div class="form-group">
                           <label for="name">Name:</label>
                           <input type="text" id="name" name="name" value="<%= modeData.name %>" required>
                       </div>
                       <div class="form-group">
                           <label for="description">Description:</label>
                           <textarea id="description" name="description" placeholder="Enter description..."></textarea>
                       </div>
                       <div class="form-group">
                           <label>Device Type:</label>
                           <p>
                               <img src="/images/<%= modeData.deviceType.toLowerCase() %>-logo-square-64.png" alt="<%= modeData.deviceType %> Icon"> <%= modeData.deviceType %>
                           </p>
                       </div>
                       <div class="form-group">
                           <label>Flags:</label>
                           <p><%= modeData.flags %></p>
                       </div>
                   </div>
                   <div class="pat-submission-showcase">
                       <% modeData.jsonData.modes[0].single_pats.forEach((pat, index) => { %>
                           <div class="pat-tile <%= pat.isDuplicate ? 'duplicate' : 'new' %>">
                               <h3>Pattern <%= index + 1 %></h3>
                               <p>Pattern Name: <%= pat.patternName %></p>
                               <p>Colorset: <%= pat.colorset.join(', ') %></p>
                               <% if (pat.isDuplicate) { %>
                                   <p class="duplicate-message">This pattern already exists.</p>
                                   <button type="button" class="keep-button" data-index="<%= index %>">Keep</button>
                               <% } %>
                               <input type="hidden" name="selectedPatternSets" value="<%= index %>">
                           </div>
                       <% }); %>
                   </div>
                   <div class="submit-button">
                       <button type="submit">Submit Mode</button>
                   </div>
               </form>
           </section>
        </div>
    </main>
    <%- include('partials/footer') %>
    <%- include('partials/script') %>
    <script>
      document.querySelectorAll('.keep-button').forEach(button => {
        button.addEventListener('click', function() {
          const index = this.dataset.index;
          const tile = this.closest('.pat-tile');
          tile.classList.remove('duplicate');
          tile.classList.add('new');
          tile.querySelector('.duplicate-message').remove();
          this.remove();
        });
      });
    </script>
</body>
</html>
